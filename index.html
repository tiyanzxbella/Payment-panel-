<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <meta name="HandheldFriendly" content="false">
  <title>Pembelian Produk Panel</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      position: relative;
      overflow-x: hidden;
      background-image: url('https://files.catbox.moe/ele9lp.jpg');
      background-size: cover;
      background-position: center;
      min-width: 1024px;
    }

    .produk-glitch {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
      opacity: 0;
      background-size: cover;
      mix-blend-mode: difference;
      border-radius: 10px;
    }

    .produk-glitch::before, .produk-glitch::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: inherit;
      opacity: 0.5;
      border-radius: 10px;
    }

    .produk-glitch::before {
      left: 2px;
      animation: glitch-anim-1 2s infinite linear alternate-reverse;
      clip-path: polygon(0 0, 100% 0, 100% 45%, 0 45%);
    }

    .produk-glitch::after {
      left: -2px;
      animation: glitch-anim-2 2s infinite linear alternate-reverse;
      clip-path: polygon(0 60%, 100% 60%, 100% 100%, 0 100%);
    }

    @keyframes glitch-anim-1 {
      0% { transform: translate(2px, 2px); }
      100% { transform: translate(-2px, -2px); }
    }

    @keyframes glitch-anim-2 {
      0% { transform: translate(-2px, 2px); }
      100% { transform: translate(2px, -2px); }
    }

    .glitch-text {
      position: relative;
      text-shadow: 1px 1px 0 #ff00ff, -1px -1px 0 #00ffff;
    }

    #barcode-container {
      text-align: center;
      margin-bottom: 20px;
    }

    .produk-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }

    .produk-row {
      display: flex;
      gap: 20px;
      justify-content: center;
    }

    .produk-item {
      border: 1px solid #ddd;
      padding: 20px;
      width: 200px;
      text-align: center;
      background-color: rgba(255, 255, 255, 0.9);
      border-radius: 10px;
      transition: transform 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .produk-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }

    .produk-item img {
      width: 150px;
      height: 150px;
      object-fit: cover;
      margin-bottom: 10px;
      border-radius: 8px;
    }

    button {
      background-color: #333;
      color: #fff;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      border-radius: 5px;
      transition: all 0.3s ease;
    }

    button:hover {
      background-color: #555;
    }

    .btn-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 30px;
      flex-wrap: wrap;
    }

    .payment-btn {
      background: linear-gradient(45deg, #ff6ec4, #7873f5, #1fd1f9);
      background-size: 200% 200%;
      animation: gradientBtn 4s ease infinite;
      color: #fff;
      font-weight: 600;
      border-radius: 12px;
      text-decoration: none;
      transition: 0.3s;
      padding: 14px 24px;
      display: inline-block;
    }

    .store-btn {
      background: linear-gradient(45deg, #00c6ff, #0072ff, #a166cc);
      background-size: 200% 200%;
      animation: gradientBtn 4s ease infinite;
      color: #fff;
      font-weight: 600;
      border-radius: 12px;
      text-decoration: none;
      transition: 0.3s;
      padding: 14px 24px;
      display: inline-block;
    }

    .payment-btn:hover, .store-btn:hover {
      transform: scale(1.05);
    }

    @keyframes gradientBtn {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .ripple {
      position: absolute;
      border-radius: 50%;
      transform: scale(0);
      animation: ripple-animation 0.6s linear;
      background-color: rgba(255, 255, 255, 0.7);
      pointer-events: none;
      z-index: 1000;
    }

    @keyframes ripple-animation {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }

    footer {
      text-align: center;
      margin: 30px 0;
      font-size: 16px;
      color: white;
      background-color: rgba(0, 0, 0, 0.5);
      padding: 15px;
      border-radius: 5px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    footer a {
      color: #fff;
      text-decoration: none;
      font-weight: bold;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    footer a:hover {
      transform: scale(1.1);
    }

    .social-icon {
      width: 24px;
      height: 24px;
      vertical-align: middle;
    }

    canvas#salju {
      position: fixed;
      top: 0;
      left: 0;
      pointer-events: none;
      z-index: 9999;
    }

    h1 {
      text-align: center;
      color: white;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      background-color: rgba(0, 0, 0, 0.5);
      padding: 15px;
      margin: 0 0 20px 0;
      border-radius: 5px;
    }

    .popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 10001;
    }

    .popup-content {
        background-color: white;
        padding: 30px 40px;
        border-radius: 10px;
        text-align: center;
        width: 80%;
        max-width: 450px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
        color: #333;
        font-size: 18px;
    }

    .popup-content h2 {
        margin-top: 0;
        color: #e63946;
        background-color: transparent;
        text-shadow: none;
        padding: 0;
        margin-bottom: 15px;
        font-size: 24px;
    }

    .popup-content p {
        margin-bottom: 25px;
        line-height: 1.6;
    }

    .popup-content button {
        background-color: #007bff;
        color: #fff;
        padding: 12px 25px;
        border-radius: 8px;
        font-size: 16px;
    }

    .popup-content button:hover {
        background-color: #0056b3;
    }

    .desktop-container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      box-sizing: border-box;
      position: relative;
    }

    #music-control {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
      background-color: rgba(0, 0, 0, 0.7);
      padding: 10px;
      border-radius: 50%;
      cursor: pointer;
      color: white;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    #music-control:hover {
      background-color: rgba(0, 0, 0, 0.9);
      transform: scale(1.1);
    }

    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      color: white;
      font-size: 24px;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* STYLE CHAT AI YANG LEBIH BAIK */
    .chat-container {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80%;
      height: 80%;
      max-width: 800px;
      max-height: 700px;
      /* Mengubah background-color menjadi linear-gradient */
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(248, 248, 248, 0.98));
      z-index: 2000;
      display: none;
      border-radius: 15px;
      box-shadow: 0 0 25px rgba(0,0,0,0.4); /* Meningkatkan shadow */
      flex-direction: column;
    }

    .chat-header {
      display: flex;
      padding: 20px;
      /* Mengubah background-color menjadi linear-gradient */
      background: linear-gradient(90deg, #7873f5, #1fd1f9);
      color: white;
      font-size: 20px;
      border-top-left-radius: 15px;
      border-top-right-radius: 15px;
      align-items: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2); /* Menambahkan shadow */
    }

    .chat-header button {
      background-color: transparent;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 24px;
      margin-right: 15px;
    }

    .chat-body {
      padding: 20px;
      height: calc(100% - 180px);
      overflow-y: auto;
      font-size: 18px;
      /* Mengubah background-color */
      background-color: #f5f8fb;
    }

    .chat-message {
      margin-bottom: 15px;
      padding: 12px 15px;
      border-radius: 10px;
      max-width: 80%;
      font-size: 18px;
      line-height: 1.5;
      word-wrap: break-word;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1); /* Menambahkan shadow ke pesan */
    }

    .user-message {
      /* Mengubah background-color */
      background-color: #cbe6ff;
      margin-left: auto;
      border-bottom-right-radius: 5px;
    }

    .bot-message {
      /* Mengubah background-color */
      background-color: #e9e9e9;
      margin-right: auto;
      border-bottom-left-radius: 5px;
    }

    .chat-input {
      padding: 15px;
      /* Mengubah background-color */
      background-color: #eef2f7;
      border-top: 1px solid #ddd;
      display: flex;
      align-items: center;
      border-bottom-left-radius: 15px;
      border-bottom-right-radius: 15px;
    }

    .chat-input input[type="text"] {
      width: calc(100% - 140px);
      padding: 15px;
      border: 1px solid #c0c0c0; /* Sedikit menggelapkan border input */
      border-radius: 8px;
      margin-right: 15px;
      font-size: 18px;
    }

    .chat-input button {
      background-color: #333;
      color: white;
      border: none;
      padding: 15px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
      transition: all 0.3s;
    }

    .chat-input button:hover {
      background-color: #555;
    }

    .chat-nav {
      display: flex;
      justify-content: space-around;
      padding: 15px;
      /* Mengubah background-color */
      background-color: #eef2f7;
      border-top: 1px solid #ddd;
    }

    .chat-nav button {
      margin: 0 10px;
      flex-grow: 1;
      max-width: 300px;
      font-size: 18px;
      padding: 15px 25px;
    }

    #chat-button {
      position: absolute;
      top: 20px;
      right: 20px;
      background: linear-gradient(45deg, #00c6ff, #0072ff, #a166cc);
      background-size: 200% 200%;
      animation: gradientBtn 4s ease infinite;
      color: #fff;
      font-weight: 600;
      border-radius: 12px;
      padding: 15px 25px;
      cursor: pointer;
      text-align: center;
      z-index: 1000;
      transition: transform 0.3s ease;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #chat-button:hover {
      transform: scale(1.05);
    }

    #chat-button p {
      margin: 0;
    }

    .chat-icon {
      width: 24px;
      height: 24px;
    }

    /* STYLE TAMBAHAN UNTUK AI CHAT */
    .message-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
      align-items: center;
    }
    
    .typing-dots {
      display: inline-block;
      position: relative;
    }
    
    .typing-dots::after {
      content: "...";
      animation: typing 1.5s infinite;
      position: absolute;
      left: 0;
    }
    
    @keyframes typing {
      0% { content: "."; }
      33% { content: ".."; }
      66% { content: "..."; }
    }
    
    .suggested-questions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }
    
    .suggested-question {
      /* Mengubah background-color */
      background-color: #d8e2ed;
      padding: 8px 12px;
      border-radius: 15px;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    
    .suggested-question:hover {
      background-color: #cbe6ff; /* Mengubah hover color */
    }
    
    .chat-message pre {
      background-color: #f5f5f5;
      padding: 10px;
      border-radius: 5px;
      overflow-x: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    
    .chat-message code {
      font-family: monospace;
      background-color: #f5f5f5;
      padding: 2px 4px;
      border-radius: 3px;
    }
    
    /* Style untuk link dalam chat */
    .chat-message a {
      color: #007bff;
      text-decoration: none;
      font-weight: bold;
      transition: all 0.2s;
    }
    
    .chat-message a:hover {
      text-decoration: underline;
      color: #0056b3;
    }
    
    /* Style untuk riwayat chat */
    .chat-history-btn {
      position: absolute;
      right: 20px;
      background: transparent;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .history-icon {
      width: 18px;
      height: 18px;
    }
    
    .chat-history-panel {
      position: absolute;
      top: 0;
      right: -350px;
      width: 350px;
      height: 100%;
      /* Mengubah background-color */
      background-color: #f5f8fb;
      box-shadow: -5px 0 15px rgba(0,0,0,0.1);
      transition: right 0.3s ease;
      overflow-y: auto;
      padding: 20px;
      z-index: 10;
      display: none;
    }
    
    .chat-history-panel.active {
      right: 0;
      display: block;
    }
    
    .chat-history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #ddd;
    }
    
    .chat-history-item {
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 5px;
      /* Mengubah background-color */
      background-color: #eaf1f7;
      cursor: pointer;
      transition: background-color 0.3s;
      animation: fadeIn 0.3s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .chat-history-item:hover {
      background-color: #d8e2ed; /* Mengubah hover color */
    }
    
    .chat-history-item h4 {
      margin: 0 0 5px 0;
      color: #333;
    }
    
    .chat-history-item p {
      margin: 0;
      color: #666;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .chat-history-item .time {
      font-size: 12px;
      color: #999;
      text-align: right;
    }
    
    .no-history {
      color: #999;
      text-align: center;
      margin-top: 50px;
    }
    
    .close-history {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: #666;
    }
    
    /* Tombol Hapus Riwayat */
    .clear-history-btn {
      background-color: #e74c3c;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      margin-top: 15px;
      width: 100%;
      transition: background-color 0.3s;
    }
    
    .clear-history-btn:hover {
      background-color: #c0392b;
    }
    
    /* Pemberitahuan AI */
    .ai-notification {
      /* Mengubah background-color */
      background-color: #e6f2e6;
      border-left: 4px solid #4CAF50;
      padding: 10px;
      margin-top: 10px;
      font-size: 14px;
      border-radius: 0 5px 5px 0;
    }
  </style>
</head>
<body>
  <canvas id="salju"></canvas>

  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
    <p id="loading-text">Mengarahkan...</p>
  </div>

  <div id="popup-warning" class="popup-overlay">
      <div class="popup-content">
          <h2>Peringatan Perangkat Mobile</h2>
          <p>⚠️ Untuk pengalaman visual dan fungsionalitas terbaik, sangat disarankan menggunakan perangkat desktop atau mengaktifkan mode desktop pada browser mobile Anda, dan disarankan untuk berhati-hati dalam bertransaksi pada siapapun dan dimanapun. ⚠️</p>
          <button id="close-popup">Saya Mengerti</button>
      </div>
  </div>

  <audio id="background-music" loop>
    <source src="https://nathanprinsley-files.prinsh.com/data-1/mp3/safe-and-sound_rebelution.mp3" type="audio/mpeg">
    Browser Anda tidak mendukung elemen audio.
  </audio>

  <div id="music-control" title="Play/Pause Music">♪</div>

  <div class="desktop-container">
    <div id="chat-button">
      <svg class="chat-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white">
        <path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>
      </svg>
      <p>AI Assistant</p>
    </div>

    <div id="barcode-container">
      <img id="barcode" src="https://cdn.xtermai.xyz/i47/42" alt="Barcode" style="width: 500px; height: 450px; border-radius: 12px; margin: 50px auto; transition: transform 0.3s ease;">
    </div>

    <h1 class="glitch-text">Pembelian Produk Panel</h1>
    <div id="produk" class="produk-wrapper"></div>

    <div class="btn-container">
      <button class="store-btn" id="go-to-store">Lanjut ke Web Store</button>
      <button class="payment-btn" id="go-to-payment-page">Lanjut ke Pembayaran</button>
    </div>

    <footer>
      <a href="https://instagram.com/septiyanda_putra" target="_blank">
        <img src="https://cdn-icons-png.flaticon.com/512/2111/2111463.png" alt="Instagram" class="social-icon">
        @septiyanda_putra
      </a>
      <a href="https://chat.whatsapp.com/EQkSNg1QgWG0pEaGWwdnuv" target="_blank">
        <img src="https://cdn-icons-png.flaticon.com/512/220/220236.png" alt="WhatsApp" class="social-icon">
        Grup WhatsApp
      </a>
    </footer>
  </div>

  <!-- Chat AI yang sudah ditingkatkan -->
  <div class="chat-container" id="chat-container">
    <div class="chat-header">
      <button id="close-chat">✕</button>
      <div style="margin-left: 10px; font-weight: bold;">AI Assistant Pembelian</div>
      <button class="chat-history-btn" id="show-history">
        <svg class="history-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white">
          <path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/>
        </svg>
        Riwayat
      </button>
      <div id="typing-indicator" style="margin-left: auto; display: none; color: #666; font-size: 14px;">
        <span class="typing-dots">...</span>
      </div>
    </div>
    
    <div class="chat-history-panel" id="chat-history-panel">
      <div class="chat-history-header">
        <h3>Riwayat Percakapan</h3>
        <button class="close-history" id="close-history">✕</button>
      </div>
      <div id="history-list">
        <!-- Riwayat chat akan dimuat di sini -->
        <div class="no-history">Tidak ada riwayat percakapan</div>
      </div>
      <!-- Tombol Hapus Semua Riwayat -->
      <button class="clear-history-btn" id="clear-history-btn">Hapus Semua Riwayat</button>
    </div>
    
    <div class="chat-body" id="chat-body">
      <!-- Pesan awal akan dimuat secara dinamis oleh initChat() -->
    </div>
    <div class="chat-input">
      <input type="text" id="chat-input" placeholder="Ketik pesan Anda..." autocomplete="off">
      <button id="send-button">Kirim</button>
    </div>
    <div class="chat-nav">
      <button class="store-btn" id="chat-go-to-store">Lanjut ke Web Store</button>
      <button class="payment-btn" id="chat-go-to-payment">Lanjut ke Pembayaran</button>
    </div>
  </div>

  <script>
    // ==================== KODE UNTUK MUSIK OTOMATIS ====================
    const backgroundMusic = document.getElementById('background-music');
    const musicControl = document.getElementById('music-control');
    let isMusicPlaying = false;
    let musicAttemptedToPlay = false; // Flag untuk memastikan autoplay hanya mencoba sekali per interaksi

    // Fungsi untuk mencoba memutar musik saat ada interaksi pertama
    function setupAudio() {
      // Hapus event listener setelah dipicu sekali
      document.removeEventListener('click', setupAudio);
      document.removeEventListener('touchstart', setupAudio);
      playBackgroundMusic();
    }

    // Fungsi utama untuk memutar musik
    function playBackgroundMusic() {
      if (musicAttemptedToPlay) return; // Pastikan hanya mencoba sekali
      
      musicAttemptedToPlay = true; // Set flag setelah mencoba
      backgroundMusic.volume = 0.3; // Atur volume

      const playPromise = backgroundMusic.play();
      
      if (playPromise !== undefined) {
        playPromise.then(() => {
          // Autoplay berhasil dimulai
          isMusicPlaying = true;
          musicControl.textContent = '❚❚'; // Ubah ikon menjadi 'pause'
          console.log('Musik berhasil diputar secara otomatis.');
        }).catch(error => {
          // Autoplay dicegah oleh browser
          console.warn('Autoplay musik dicegah oleh browser:', error);
          isMusicPlaying = false;
          musicControl.textContent = '♪'; // Pastikan ikon tetap 'play'
          // Tidak perlu alert lagi, karena tombol kontrol musik selalu terlihat
        });
      }
    }

    // Fungsi untuk mengaktifkan/menonaktifkan musik secara manual
    function toggleMusic() {
      if (isMusicPlaying) {
        backgroundMusic.pause();
        musicControl.textContent = '♪'; // Ubah ikon menjadi 'play'
      } else {
        backgroundMusic.play().then(() => {
          musicControl.textContent = '❚❚'; // Ubah ikon menjadi 'pause'
          isMusicPlaying = true;
        }).catch(error => {
          console.error('Gagal memutar musik secara manual:', error);
          musicControl.textContent = '♪'; // Pastikan ikon tetap 'play'
          isMusicPlaying = false;
        });
      }
      isMusicPlaying = !isMusicPlaying; // Update status setelah toggle
    }

    // Event listener untuk tombol kontrol musik
    musicControl.addEventListener('click', toggleMusic);
    // Event listener untuk mencoba autoplay pada interaksi pertama di seluruh dokumen
    document.addEventListener('click', setupAudio, { once: true });
    document.addEventListener('touchstart', setupAudio, { once: true });

    // ==================== KODE PRODUK DAN FUNGSIONALITAS UTAMA ====================
    const produk = [
      { id: 1, nama: 'Panel 1GB', harga: 1000, gambar: 'https://cdn.xtermai.xyz/i6/8LYhd' },
      { id: 2, nama: 'Panel 2GB', harga: 2000, gambar: 'https://cdn.xtermai.xyz/i6/8LYhd' },
      { id: 3, nama: 'Panel 3GB', harga: 3000, gambar: 'https://cdn.xtermai.xyz/i6/8LYhd' },
      { id: 4, nama: 'Panel 4GB', harga: 4000, gambar: 'https://cdn.xtermai.xyz/i6/8LYhd' },
      { id: 5, nama: 'Panel 5GB', harga: 5000, gambar: 'https://cdn.xtermai.xyz/i6/8LYhd' },
      { id: 6, nama: 'Panel 6GB', harga: 6000, gambar: 'https://cdn.xtermai.xyz/i6/8LYhd' },
      { id: 7, nama: 'Panel 7GB', harga: 7000, gambar: 'https://cdn.xtermai.xyz/i6/8LYhd' },
      { id: 8, nama: 'Panel 8GB', harga: 8000, gambar: 'https://cdn.xtermai.xyz/i6/8LYhd' },
      { id: 9, nama: 'Panel 9GB', harga: 9000, gambar: 'https://cdn.xtermai.xyz/i6/8LYhd' },
      { id: 10, nama: 'Panel 10GB', harga: 10000, gambar: 'https://cdn.xtermai.xyz/i6/8LYhd' },
      { id: 11, nama: 'Panel Unli', harga: 15000, gambar: 'https://cdn.xtermai.xyz/i6/8LYhd' },
    ];

    // Render produk ke halaman
    const produkContainer = document.getElementById('produk');
    for (let i = 0; i < produk.length; i += 3) {
      const row = document.createElement('div');
      row.classList.add('produk-row');
      for (let j = 0; j < 3; j++) {
        if (i + j < produk.length) {
          const item = produk[i + j];
          const itemDiv = document.createElement('div');
          itemDiv.classList.add('produk-item');
          itemDiv.innerHTML = `
            <img src="${item.gambar}" alt="${item.nama}">
            <h2>${item.nama}</h2>
            <p>Rp ${item.harga.toLocaleString()}</p>
            <button onclick="beliProduk(${item.id}, event)">Beli</button>
          `;
          row.appendChild(itemDiv);
        }
      }
      produkContainer.appendChild(row);
    }

    // Fungsi beli produk (tetap sama)
    function beliProduk(id, event) {
      const produkDipilih = produk.find((item) => item.id === id);
      if (produkDipilih) {
        createRipple(event);
        const productItem = event.currentTarget.closest('.produk-item');
        const glitch = productItem.querySelector('.produk-glitch');
        if (glitch) {
          glitch.style.opacity = '0.5';
          setTimeout(() => {
            glitch.style.opacity = '0';
          }, 300);
        }
        const pesan = `Halo, saya ingin membeli ${produkDipilih.nama} seharga Rp ${produkDipilih.harga}`;
        const nomorWhatsApp = '6285972533957';
        const urlWhatsApp = `https://wa.me/${nomorWhatsApp}?text=${encodeURIComponent(pesan)}`;
        setTimeout(() => {
          window.open(urlWhatsApp, '_blank');
        }, 300);
      } else {
        alert('Produk tidak ditemukan');
      }
    }

    // Fungsi ripple effect (tetap sama)
    function createRipple(event) {
      const button = event.currentTarget;
      const circle = document.createElement("span");
      const diameter = Math.max(button.clientWidth, button.clientHeight);
      const radius = diameter / 2;
      circle.classList.add("ripple");
      circle.style.width = circle.style.height = `${diameter}px`;
      circle.style.left = `${event.offsetX - radius}px`;
      circle.style.top = `${event.offsetY - radius}px`;
      button.appendChild(circle);
    }

    // Redirect ke store (tetap sama)
    document.getElementById('go-to-store').addEventListener('click', function() {
      document.getElementById('loadingOverlay').style.display = 'flex';
      document.getElementById('loading-text').textContent = 'Mengarahkan ke Web Store...';
      setTimeout(() => {
        window.location.href = 'https://buylink.id/Tiyanstore';
      }, 1000);
    });

    // Redirect ke payment (tetap sama)
    document.getElementById('go-to-payment-page').addEventListener('click', function() {
      document.getElementById('loadingOverlay').style.display = 'flex';
      document.getElementById('loading-text').textContent = 'Mengarahkan ke halaman pembayaran...';
      setTimeout(() => {
        window.location.href = 'https://tiyanpalestine.github.io/Website-payment/';
      }, 1000);
    });

    // ==================== KODE UNTUK AI CHAT ====================
    const chatButton = document.getElementById('chat-button');
    const chatContainer = document.getElementById('chat-container');
    const closeChatButton = document.getElementById('close-chat');
    const chatBody = document.getElementById('chat-body');
    const chatInput = document.getElementById('chat-input');
    const sendButton = document.getElementById('send-button');
    const typingIndicator = document.getElementById('typing-indicator');
    const showHistoryBtn = document.getElementById('show-history');
    const chatHistoryPanel = document.getElementById('chat-history-panel');
    const closeHistoryBtn = document.getElementById('close-history');
    const historyList = document.getElementById('history-list');
    const clearHistoryBtn = document.getElementById('clear-history-btn'); // New button

    let conversationHistory = []; // Ini akan menyimpan pesan untuk sesi chat yang sedang aktif
    const CHAT_HISTORY_KEY = 'yolaAssistantChatHistory'; // Kunci untuk Local Storage
    const MAX_HISTORY_ITEMS = 10; // Batas maksimal jumlah percakapan yang disimpan

    // Inisialisasi chat (dipanggil saat DOMContentLoaded)
    function initChat() {
      clearChat(); // Selalu mulai dengan tampilan chat yang baru
    }

    // Fungsi untuk mengosongkan tampilan chat dan mereset riwayat sesi aktif
    function clearChat() {
      chatBody.innerHTML = '';
      conversationHistory = []; // Reset riwayat sesi aktif
      addWelcomeMessage(); // Tambahkan pesan selamat datang untuk sesi baru
    }

    // Tambahkan pesan selamat datang AI ke chat body
    function addWelcomeMessage() {
      // Set riwayat sesi aktif dengan pesan selamat datang
      conversationHistory = [{ 
        role: "assistant", 
        content: "Halo! Saya adalah AI Assistant yang siap membantu Anda dengan pertanyaan seputar produk dan pembelian.\n\nAnda bisa menanyakan tentang:\n- Detail produk dan spesifikasi\n- Harga dan promo terbaru\n- Metode pembayaran yang tersedia\n- Status pesanan\n- grup wa/grup bot\n\nBagaimana saya bisa membantu Anda hari ini?" 
      }];

      const welcomeMessageHtml = `
        <div class="chat-message bot-message">
          <div class="message-header">
            <strong>AI Assistant</strong>
            <span class="message-time">${getCurrentTime()}</span>
          </div>
          ${formatMessageWithLinks(conversationHistory[0].content).innerHTML}
          ${addSuggestedQuestionsHTML()}
          <div class="ai-notification">
            <strong>Penting:</strong> AI ini dapat mengenali kata-kata dengan typo seperti "prodiukk", "pembayaran", "harga", dll.
          </div>
        </div>
      `;
      
      chatBody.innerHTML = welcomeMessageHtml;
      chatBody.scrollTop = chatBody.scrollHeight; // Scroll ke bawah
    }

    // Pertanyaan saran
    const suggestedQuestions = [
      "Apa saja produk yang tersedia?",
      "Bagaimana cara melakukan pembayaran?",
      "Apakah ada promo saat ini?",
      "Berapa harga panel 5GB?",
      "Bagaimana cara menghubungi customer service?",
      "Bagaimana cara bergabung ke Grup WhatsApp?"
    ];

    // Fungsi untuk menghasilkan HTML pertanyaan saran
    function addSuggestedQuestionsHTML() {
      let html = '<div class="suggested-questions">';
      suggestedQuestions.forEach(question => {
        html += `<div class="suggested-question" onclick="setSuggestedQuestion('${question.replace(/'/g, "\\'")}')">${question}</div>`;
      });
      html += '</div>';
      return html;
    }

    // Set pertanyaan saran ke input chat
    function setSuggestedQuestion(question) {
      chatInput.value = question;
      chatInput.focus();
    }

    // Event listener untuk tombol buka riwayat chat
    showHistoryBtn.addEventListener('click', function() {
      if (chatHistoryPanel.style.display === 'none' || !chatHistoryPanel.style.display) {
        loadChatHistory(); // Muat riwayat saat panel dibuka
        chatHistoryPanel.style.display = 'block';
        setTimeout(() => {
          chatHistoryPanel.style.right = '0';
        }, 10);
      } else {
        chatHistoryPanel.style.right = '-350px';
        setTimeout(() => {
          chatHistoryPanel.style.display = 'none';
        }, 300);
      }
    });

    // Event listener untuk tombol tutup riwayat chat
    closeHistoryBtn.addEventListener('click', function() {
      chatHistoryPanel.style.right = '-350px';
      setTimeout(() => {
        chatHistoryPanel.style.display = 'none';
      }, 300);
    });

    // Fungsi untuk mendapatkan riwayat chat dari Local Storage
    function getChatHistory() {
      const saved = localStorage.getItem(CHAT_HISTORY_KEY);
      return saved ? JSON.parse(saved) : [];
    }

    // Fungsi untuk menyimpan percakapan sesi aktif ke riwayat
    function saveCurrentConversationToHistory() {
      // Hanya simpan jika ada interaksi nyata (lebih dari pesan selamat datang AI saja)
      if (conversationHistory.length > 1) {
        const chatData = {
          id: Date.now(), // ID unik untuk setiap sesi
          timestamp: Date.now(),
          messages: [...conversationHistory], // Salin seluruh riwayat sesi aktif
          // Gunakan pesan pengguna pertama sebagai pratinjau
          preview: conversationHistory.find(msg => msg.role === 'user')?.content.substring(0, 100) || "Percakapan baru"
        };

        let history = getChatHistory();
        
        // Tambahkan sesi baru ke riwayat
        history.push(chatData);

        // Batasi jumlah riwayat
        if (history.length > MAX_HISTORY_ITEMS) {
          history = history.slice(history.length - MAX_HISTORY_ITEMS); // Pertahankan N sesi terbaru
        }

        localStorage.setItem(CHAT_HISTORY_KEY, JSON.stringify(history));
      }
    }

    // Fungsi untuk memuat dan menampilkan riwayat chat di panel riwayat
    function loadChatHistory() {
      const savedChats = getChatHistory();
      historyList.innerHTML = ''; // Bersihkan daftar sebelumnya
      
      if (savedChats.length === 0) {
        historyList.innerHTML = '<div class="no-history">Tidak ada riwayat percakapan</div>';
      } else {
        // Tampilkan riwayat dari yang paling baru ke yang paling lama
        savedChats.slice().reverse().forEach((chat) => { // Menggunakan slice().reverse() untuk menampilkan yang terbaru di atas
          const chatItem = document.createElement('div');
          chatItem.className = 'chat-history-item';
          
          const chatDate = new Date(chat.timestamp);
          const formattedDate = chatDate.toLocaleDateString('id-ID', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric'
          });
          const formattedTime = chatDate.toLocaleTimeString('id-ID', {
            hour: '2-digit',
            minute: '2-digit'
          });
          
          chatItem.innerHTML = `
            <h4>Percakapan pada ${formattedDate}</h4>
            <p>${chat.preview}</p>
            <div class="time">${formattedTime}</div>
          `;
          
          // Event listener untuk memuat percakapan yang dipilih
          chatItem.addEventListener('click', () => {
            loadSelectedChat(chat.messages);
            chatHistoryPanel.style.right = '-350px';
            setTimeout(() => {
              chatHistoryPanel.style.display = 'none';
            }, 300);
          });
          
          historyList.appendChild(chatItem);
        });
      }
    }

    // Fungsi untuk menghapus semua riwayat chat dari Local Storage
    function clearAllChatHistory() {
      if (confirm('Apakah Anda yakin ingin menghapus semua riwayat percakapan? Tindakan ini tidak dapat dibatalkan.')) {
        localStorage.removeItem(CHAT_HISTORY_KEY);
        loadChatHistory(); // Muat ulang panel riwayat untuk menampilkan bahwa sudah kosong
        alert('Semua riwayat percakapan telah dihapus.');
      }
    }

    // Event listener untuk tombol Hapus Semua Riwayat
    clearHistoryBtn.addEventListener('click', clearAllChatHistory);

    // Fungsi untuk memuat percakapan yang dipilih ke tampilan chat utama
    function loadSelectedChat(messages) {
      chatBody.innerHTML = ''; // Bersihkan chat body
      conversationHistory = [...messages]; // Set riwayat sesi aktif dengan yang dipilih
      
      messages.forEach(msg => {
        const messageDiv = document.createElement('div');
        messageDiv.className = `chat-message ${msg.role === 'user' ? 'user-message' : 'bot-message'}`;
        
        const header = document.createElement('div');
        header.className = 'message-header';
        header.innerHTML = `<strong>${msg.role === 'user' ? 'Anda' : 'AI Assistant'}</strong><span class="message-time">${getCurrentTime()}</span>`;
        
        messageDiv.appendChild(header);
        
        // Format konten pesan dengan link dan baris baru
        const contentDiv = formatMessageWithLinks(msg.content);
        messageDiv.appendChild(contentDiv);
        
        chatBody.appendChild(messageDiv);
      });
      
      chatBody.scrollTop = chatBody.scrollHeight; // Scroll ke bawah
    }

    // Fungsi untuk membuat link dapat diklik dan menangani baris baru dalam pesan
    function formatMessageWithLinks(text) {
      const div = document.createElement('div');
      const urlRegex = /(https?:\/\/[^\s]+)/g;
      
      // Pisahkan teks berdasarkan baris baru
      const lines = text.split('\n');

      lines.forEach((line, lineIndex) => {
        const lineFragment = document.createDocumentFragment();
        let lastIndex = 0;
        
        // Cari URL dalam setiap baris
        const matches = [...line.matchAll(urlRegex)];
        
        matches.forEach(match => {
          const url = match[0];
          const matchIndex = match.index;
          
          // Tambahkan teks sebelum URL
          if (matchIndex > lastIndex) {
            lineFragment.appendChild(document.createTextNode(line.substring(lastIndex, matchIndex)));
          }
          
          // Buat elemen link
          const link = document.createElement('a');
          link.href = url;
          link.textContent = url;
          link.target = '_blank';
          link.rel = 'noopener noreferrer';
          link.style.color = '#007bff';
          link.style.textDecoration = 'none';
          link.style.fontWeight = 'bold';
          link.style.cursor = 'pointer';
          link.addEventListener('mouseover', () => { link.style.textDecoration = 'underline'; });
          link.addEventListener('mouseout', () => { link.style.textDecoration = 'none'; });
          lineFragment.appendChild(link);
          
          lastIndex = matchIndex + url.length;
        });
        
        // Tambahkan sisa teks setelah URL terakhir dalam baris
        if (lastIndex < line.length) {
          lineFragment.appendChild(document.createTextNode(line.substring(lastIndex)));
        }
        
        div.appendChild(lineFragment);
        
        // Tambahkan <br> untuk baris baru, kecuali setelah baris terakhir
        if (lineIndex < lines.length - 1) {
          div.appendChild(document.createElement('br'));
        }
      });
      
      return div;
    }

    // Tampilkan indikator mengetik
    function showTypingIndicator() {
      typingIndicator.style.display = 'block';
    }

    // Sembunyikan indikator mengetik
    function hideTypingIndicator() {
      typingIndicator.style.display = 'none';
    }

    // Dapatkan waktu saat ini
    function getCurrentTime() {
      const now = new Date();
      return now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }

    // Fungsi untuk mengenali typo dan mengoreksi kata kunci
    function recognizeTypo(word) {
      const keywordMap = {
        'produk': ['prodiuk', 'prodak', 'produck', 'produt', 'prooduk', 'produkt'],
        'pembayaran': ['pembayran', 'pembayarn', 'pembayran', 'pembayarran', 'bayar', 'payment'],
        'harga': ['hargga', 'harha', 'harg', 'harganya', 'price', 'brp'],
        'panel': ['panell', 'pannel', 'panal', 'penel'],
        'unli': ['unli', 'unlimited', 'unlimeted', 'unl'],
        'gb': ['gb', 'g', 'gigabyte', 'giga'],
        'whatsapp': ['wa', 'whatsapp', 'watsapp', 'whatsap', 'grup wa', 'grup bot'],
        'cs': ['cs', 'customer service', 'cust service', 'cust svc', 'bantuan', 'kontak']
      };
      
      const normalizedWord = word.toLowerCase().trim();
      
      for (const [correctWord, variations] of Object.entries(keywordMap)) {
        if (variations.includes(normalizedWord) || normalizedWord.includes(correctWord)) {
          return correctWord;
        }
      }
      
      return word; // Kembalikan kata asli jika tidak ada typo yang dikenali
    }

    // Fungsi untuk mengirim pesan dan mendapatkan respons AI
    async function sendMessage() {
      const message = chatInput.value.trim();
      if (message !== '') {
        // Tambahkan pesan pengguna ke chat
        const userMessageDiv = document.createElement('div');
        userMessageDiv.className = 'chat-message user-message';
        
        const userHeader = document.createElement('div');
        userHeader.className = 'message-header';
        userHeader.innerHTML = `<strong>Anda</strong><span class="message-time">${getCurrentTime()}</span>`;
        
        userMessageDiv.appendChild(userHeader);
        userMessageDiv.appendChild(document.createTextNode(message));
        chatBody.appendChild(userMessageDiv);
        
        // Tambahkan ke riwayat percakapan sesi aktif
        conversationHistory.push({ role: "user", content: message });
        
        // Kosongkan input
        chatInput.value = '';
        
        // Scroll ke bawah
        chatBody.scrollTop = chatBody.scrollHeight;
        
        // Tampilkan indikator mengetik
        showTypingIndicator();
        
        // Nonaktifkan tombol kirim
        sendButton.disabled = true;
        
        // Dapatkan respons AI
        const aiResponse = await getAIResponse(message);
        
        // Sembunyikan indikator mengetik
        hideTypingIndicator();
        sendButton.disabled = false;
        
        // Tambahkan respons AI ke chat
        const botMessageDiv = document.createElement('div');
        botMessageDiv.className = 'chat-message bot-message';
        
        const botHeader = document.createElement('div');
        botHeader.className = 'message-header';
        botHeader.innerHTML = `<strong>AI Assistant</strong><span class="message-time">${getCurrentTime()}</span>`;
        
        botMessageDiv.appendChild(botHeader);
        
        // Format konten dengan link dan baris baru
        const contentDiv = formatMessageWithLinks(aiResponse);
        botMessageDiv.appendChild(contentDiv);
        
        // Tambahkan pertanyaan saran untuk percakapan baru (jika diperlukan)
        if (conversationHistory.length <= 2) { // Hanya tampilkan saran di awal percakapan
          const suggestedDiv = document.createElement('div');
          suggestedDiv.innerHTML = addSuggestedQuestionsHTML();
          botMessageDiv.appendChild(suggestedDiv);
        }
        
        chatBody.appendChild(botMessageDiv);
        
        // Tambahkan ke riwayat percakapan sesi aktif
        conversationHistory.push({ role: "assistant", content: aiResponse });
        
        // Scroll ke bawah
        chatBody.scrollTop = chatBody.scrollHeight;
      }
    }

    // Fungsi untuk mendapatkan respons AI dengan pengenalan typo
    async function getAIResponse(message) {
      // Simulasi penundaan API
      await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 1500));
      
      // Normalisasi pesan untuk mengenali typo
      const words = message.toLowerCase().split(/\s+/);
      const normalizedWords = words.map(word => recognizeTypo(word));
      const normalizedMessage = normalizedWords.join(' ');
      
      // Logika respons AI
      if (normalizedMessage.includes('produk') || normalizedMessage.includes('panel') || normalizedMessage.includes('gb')) {
        if (normalizedMessage.includes('1gb') || normalizedMessage.includes('satu')) {
          return "Panel 1GB dijual dengan harga Rp 1.000. Produk ini cocok untuk penggunaan ringan dengan kuota 1GB.\n\nFitur:\n- Kecepatan tinggi\n- Masa aktif 30 hari\n- Support 24/7\n\nKunjungi https://buylink.id/Tiyanstore untuk informasi lebih lanjut.";
        } else if (normalizedMessage.includes('2gb') || normalizedMessage.includes('dua')) {
          return "Panel 2GB tersedia dengan harga Rp 2.000. Kuota 2GB ini cocok untuk penggunaan menengah.\n\nKeuntungan:\n- Bisa dibagi ke beberapa perangkat\n- Tanpa throttle kecepatan\n- Garansi pengisian ulang\n\nLihat detail di https://buylink.id/Tiyanstore";
        } else if (normalizedMessage.includes('unli') || normalizedMessage.includes('unlimited')) {
          return "Panel Unlimited adalah paket premium kami dengan harga Rp 15.000. Anda mendapatkan:\n\n- Kuota tanpa batas\n- Kecepatan stabil 24/7\n- Prioritas jaringan\n- Masa aktif 30 hari\n\nPilihan terbaik untuk penggunaan berat! Info lengkap: https://buylink.id/Tiyanstore";
        } else if (normalizedMessage.includes('harga') || normalizedMessage.includes('price') || normalizedMessage.includes('berapa')) {
          return "Berikut daftar harga produk kami:\n\n1GB  : Rp 1.000\n2GB  : Rp 2.000\n3GB  : Rp 3.000\n4GB  : Rp 4.000\n5GB  : Rp 5.000\n...\n10GB : Rp 10.000\nUnli: Rp 15.000\n\nHarga sudah termasuk PPN. Kunjungi https://buylink.id/Tiyanstore untuk melihat detail setiap produk.";
        } else {
          return "Kami menyediakan berbagai panel dengan kuota mulai dari 1GB hingga Unlimited. Setiap produk memiliki keunggulan:\n\n- Panel Reguler (1GB-10GB): Harga ekonomis\n- Panel Unlimited: Tanpa batas kuota\n\nProduk kami mendukung semua operator utama dengan koneksi stabil. Kunjungi https://buylink.id/Tiyanstore untuk informasi lengkap. Ada yang bisa saya bantu lebih spesifik?";
        }
      }
      else if (normalizedMessage.includes('pembayaran') || normalizedMessage.includes('bayar') || normalizedMessage.includes('payment')) {
        return "Kami menerima berbagai metode pembayaran:\n\n1. Transfer Bank (BCA, BRI, Mandiri, BNI)\n2. E-Wallet (DANA, OVO, ShopeePay, Gopay)\n3. QRIS\n4. Alfamart/Indomaret\n\nSetelah pembayaran, produk akan dikirim secara instan ke email Anda. Untuk petunjuk lengkap, kunjungi https://tiyanpalestine.github.io/Website-payment/ atau klik tombol 'Lanjut ke Pembayaran' di bawah.";
      }
      else if (normalizedMessage.includes('promo') || normalizedMessage.includes('diskon') || normalizedMessage.includes('voucher')) {
        return "Saat ini kami memiliki promo spesial:\n\n🔥 Paket Hemat 5GB + 5GB hanya Rp 7.500 (normal Rp 10.000)\n🎁 Beli 2 Panel Unli gratis 1 Panel 5GB\n\nPromo berlaku hingga akhir bulan. Gunakan kode 'HEMAT10' untuk diskon tambahan 10%! Info lengkap: https://buylink.id/Tiyanstore";
      }
      else if (normalizedMessage.includes('cs') || normalizedMessage.includes('customer service') || normalizedMessage.includes('bantuan')) {
        return "Tim customer service kami siap membantu 24 jam melalui:\n\n📞 WhatsApp: https://wa.me/6285972533957\n📧 Email: support@tiyanstore.com\n\nAnda juga bisa bergabung dengan grup WhatsApp resmi kami untuk informasi lebih cepat: https://chat.whatsapp.com/EQkSNg1QgWG0pEaGWwdnuv";
      }
      else if (normalizedMessage.includes('status') || normalizedMessage.includes('pesanan') || normalizedMessage.includes('order')) {
        return "Untuk mengecek status pesanan, Anda perlu:\n\n1. ID Transaksi (contoh: TY-20240620-123)\n2. Email yang digunakan saat pembelian\n\nSilakan kirim detail tersebut atau screenshot bukti transfer ke CS kami di https://wa.me/6285972533957 untuk bantuan lebih lanjut.";
      }
      else if (normalizedMessage.includes('grup whatsapp') || normalizedMessage.includes('grup wa') || normalizedMessage.includes('grup bot')) {
        return "Anda bisa bergabung dengan Grup WhatsApp resmi kami untuk mendapatkan informasi terbaru dan berdiskusi dengan komunitas kami:\n\n📱 Klik di sini untuk bergabung: https://chat.whatsapp.com/EQkSNg1QgWG0pEaGWwdnuv\n\nDi grup ini, Anda bisa mendapatkan update promo, bertanya langsung ke admin, dan berbagi pengalaman dengan pengguna lain.";
      }
      else if (normalizedMessage.includes('halo') || normalizedMessage.includes('hai') || normalizedMessage.includes('hello')) {
        return "Halo juga! 😊 Senang bisa membantu Anda hari ini. Ada yang bisa saya bantu seputar produk panel kami?";
      }
      else if (normalizedMessage.includes('terima kasih') || normalizedMessage.includes('thanks') || normalizedMessage.includes('makasih')) {
        return "Sama-sama! 😊 Jika ada pertanyaan lain, jangan ragu untuk bertanya ya. Semoga harimu menyenangkan!";
      }
      else {
        const randomResponses = [
          "Saya bisa membantu dengan informasi produk dan pembelian. Bisakah Anda menjelaskan lebih detail pertanyaan Anda?",
          "Maaf, saya belum sepenuhnya memahami pertanyaan Anda. Mungkin Anda bisa menanyakan tentang:\n- Daftar produk\n- Harga dan promo\n- Cara pembayaran\n- Status pesanan",
          "Untuk pertanyaan yang lebih spesifik, Anda bisa menghubungi tim customer service kami di https://wa.me/6285972533957",
          "Saya adalah AI Assistant khusus untuk informasi produk. Ada yang bisa saya bantu terkait panel kami?"
        ];
        return randomResponses[Math.floor(Math.random() * randomResponses.length)];
      }
    }

    // Event listener untuk tombol buka chat
    chatButton.addEventListener('click', function() {
      chatContainer.style.display = 'flex';
      document.getElementById('loadingOverlay').style.display = 'none';
      chatInput.focus();
    });

    // Event listener untuk tombol tutup chat
    closeChatButton.addEventListener('click', function() {
      saveCurrentConversationToHistory(); // Simpan riwayat sesi aktif saat chat ditutup
      chatContainer.style.display = 'none';
      clearChat(); // Bersihkan chat untuk sesi berikutnya
    });

    // Event listener untuk input chat (Enter key)
    chatInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        sendMessage();
      }
    });

    // Event listener untuk tombol kirim pesan
    sendButton.addEventListener('click', sendMessage);

    // Redirect dari chat ke Web Store
    document.getElementById('chat-go-to-store').addEventListener('click', function() {
      window.location.href = 'https://buylink.id/Tiyanstore';
    });

    // Redirect dari chat ke halaman pembayaran
    document.getElementById('chat-go-to-payment').addEventListener('click', function() {
      window.location.href = 'https://tiyanpalestine.github.io/Website-payment/';
    });

    // ==================== KODE SALJU DAN DETEKSI MOBILE ====================
    const popupWarning = document.getElementById('popup-warning');
    const closePopupBtn = document.getElementById('close-popup');
    const canvas = document.getElementById('salju');
    const ctx = canvas.getContext('2d');
    let snowflakes = [];

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    function createSnowflakes() {
      for (let i = 0; i < 100; i++) {
        snowflakes.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          radius: Math.random() * 4 + 1,
          speedY: Math.random() * 2 + 1,
          speedX: Math.random() * 1 - 0.5,
        });
      }
    }

    function drawSnowflakes() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = 'white';
      ctx.beginPath();
      for (let flake of snowflakes) {
        ctx.moveTo(flake.x, flake.y);
        ctx.arc(flake.x, flake.y, flake.radius, 0, Math.PI * 2);
      }
      ctx.fill();
      updateSnowflakes();
    }

    function updateSnowflakes() {
      for (let flake of snowflakes) {
        flake.y += flake.speedY;
        flake.x += flake.speedX;
        if (flake.y > canvas.height) {
          flake.y = -flake.radius;
          flake.x = Math.random() * canvas.width;
        }
      }
    }

    function animateSnow() {
      drawSnowflakes();
      requestAnimationFrame(animateSnow);
    }

    function isMobileDevice() {
      return ('ontouchstart' in window) || (navigator.maxTouchPoints > 0) || (navigator.msMaxTouchPoints > 0) || /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|rim)|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(navigator.userAgent||navigator.vendor||window.opera);
    }

    // Inisialisasi efek salju dan deteksi mobile saat DOM siap
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();
    createSnowflakes();
    animateSnow();

    if (isMobileDevice()) {
      popupWarning.style.display = 'flex';
      document.querySelector('meta[name="viewport"]').content = "width=1200, initial-scale=0.5, maximum-scale=1.0, user-scalable=yes";
      window.scrollTo(300, 300);
    }

    closePopupBtn.addEventListener('click', function() {
        popupWarning.style.display = 'none';
    });

    // Inisialisasi semua fungsionalitas saat DOM siap
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('loadingOverlay').style.display = 'none';
      initChat(); // Inisialisasi chat
      startProductGlitchEffect(); // Mulai efek glitch produk
    });

    // Fungsi efek glitch pada produk (tetap sama)
    function startProductGlitchEffect() {
      const productItems = document.querySelectorAll('.produk-item');
      
      function triggerGlitch(item) {
        if (!item.querySelector('.produk-glitch')) {
          const glitch = document.createElement('div');
          glitch.className = 'produk-glitch';
          glitch.style.backgroundImage = `url('${item.querySelector('img').src}')`;
          item.appendChild(glitch);
        }
        const glitch = item.querySelector('.produk-glitch');
        const intensity = Math.random() * 0.5;
        glitch.style.opacity = intensity;
        setTimeout(() => {
          glitch.style.opacity = '0';
          setTimeout(() => triggerGlitch(item), Math.random() * 5000 + 3000);
        }, 200);
      }
      
      productItems.forEach(item => {
        setTimeout(() => triggerGlitch(item), Math.random() * 3000);
      });
    }
  </script>
</body>
</html>
